@model ComunidadPractica.Mensaje
@{ ViewBag.Title = "Cursos disponibles"; }
<!doctype html>
<html lang="en">
<body>
	<br><br><br>
	<div>@Html.Partial("Mensaje", Model)</div><br>
	<div class="container body-content ">
		<h3 class="display-4"> @ViewBag.Title</h3>
		<br>
		<div class="row ">
			<div class="col-auto mx-auto">
				<p>Curso: </p>
			</div>
			<div class="col-lg-auto mx-auto mb-auto">
				<input class="form-control" type="text" id="filtrarPorTitulo" placeholder="Filtrar en esta página..." title="Ingrese el nombre del titulo" style="max-width:100%; float:left">
			</div>
			<div class="col-sm-auto">
				<p>Categoría: </p>
			</div>
			<div class="col-sm-auto mb-auto">
				<select id="filtrarPorCategorias" class="mul-select actualizar" data-val="true" style="width:auto">
					<option selected value='Todas'>Todas</option>
					@foreach (string categoria in ViewBag.Categorias)
					{
		                <option value=@categoria>@categoria</option>
                    }
				</select>
			</div>
			<div class="col-sm-auto">
				<p>Tópicos: </p>
			</div>
			<div class="col-sm-auto mb-auto">
				<select id="filtrarPorTopicos" class="mul-select topicos" data-val="true" name="topicos" style="width:auto">
					<option selected value='Todos'>Todos</option>
					@foreach (string topico in ViewBag.Topicos)
					{
		                <option value=@topico>@topico</option>
                    }
				</select>
			</div>
			<div class="col-sm-auto">
				<a class="btn btn-dark" onclick="refrescarCursosDinamico()" style="float:right">Refrescar</a>
			</div>
		</div>
		<br />
		<div class="row scroll">
			<div class="col-lg-12">
				<div id="accordion">
					<div id="listadoDeCursosParcial"></div>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript">
        $(document).ready(function () {
            refrescarCursosDinamico();
        });

        function refrescarCursosDinamico() {
            var titulo = $("#filtrarPorTitulo").val();
            var categoria = document.getElementById("filtrarPorCategorias").value;
            var topico = document.getElementById("filtrarPorTopicos").value;
            var estado = parseInt(@ViewBag.estado);

            $.ajax({
                async: false,
                url: '/Curso/listadoDeCursosParcial',
                data: { titulo: titulo, categoria: categoria, topico: topico, estado: estado },
                type: 'POST',
                success: function (vistaParcial) {
                    $("#listadoDeCursosParcial").html(vistaParcial);
                }
            });
        }
	</script>

	<script>
        $(document).ready(function () {
            $(".mul-select").select2({
                placeholder: "- Sin selección -",
                tokenSeparators: ['/', ',', ';', " "]
            });
        });
        $('.actualizar').change(function () {
        var values = $('.actualizar').find('option:selected').map(function () {
            return $(this).val()
        }).get();


            let list = null;
            for (let i = values.length - 1; i >= 0; i--) {
                list = { value: values[i], rest: list };
            }
            var encActionURL = '@Url.Action("proponerCurso", "Curso")';
            $.ajax({
                url: encActionURL,
                type: "POST",
                data: { 'categorias': values },
                cache: false,
                success: function (data) {

                    var select = document.getElementById("filtrarPorTopicos");
                    var length = select.options.length;
                    for (i = length - 1; i >= 0; i--) {
                        select.options[i] = null;
                    }
                    $("#filtrarPorTopicos").select2("val", "");
                    var ddldist = $('#filtrarPorTopicos');
                    ddlist = ddldist.append(
                        $('<option selected></option>').val('Todos').html('Todos')
                    );
                    $.each(data, function (val, text) {
                        ddldist.append(
                            $('<option></option>').val(text).html(text)
                        );
                    });
                },
            });

        });
	</script>
</body>
</html>

